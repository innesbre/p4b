<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Module - Brendan’s shenanigans</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MMG1002H</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="mod1.html">Module 1</a>
</li>
<li>
  <a href="mod2.html">Module 2</a>
</li>
<li>
  <a href="mod3.html">Module 3</a>
</li>
<li>
  <a href="mod4.html">Module 4</a>
</li>
<li>
  <a href="mod5.html">Module 5</a>
</li>
<li>
  <a href="mod6.html">Module 6</a>
</li>
<li>
  <a href="mod7.html">Module 7</a>
</li>
<li>
  <a href="mod8.html">Module 8</a>
</li>
<li>
  <a href="mod9.html">Module 9</a>
</li>
<li>
  <a href="mod_me.html">Brendan's shenanigans</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Module - Brendan’s shenanigans</h1>

</div>


<p>Its the last class! Let’s do some silly exercises that I’m making up off the top of my head, then see if there are any gotchas to cover for the course project.</p>
<div id="exercise-hypothesis-testing-on-clustered-data" class="section level1">
<h1>Exercise: Hypothesis testing on clustered data</h1>
<p>Demonstrate to me why its a terrible idea to cluster data on a set of features then use traditional hypothesis testing to show that the features are different between clusters.</p>
<p>Remember <code>rnorm</code> to randomly sample from a normal distribution, or <code>runif</code> to sample from the uniform distribution.</p>
<p>Check out <code>?kmeans</code> for a simple clustering method.</p>
<p>The function <code>t.test</code> will do the classic Student’s T-test, but you can also use <code>wilcox.test</code> for the popular non-parametric Wilcoxon rank-sum test.</p>
<div id="generate-the-random-data" class="section level2">
<h2>Generate the random data</h2>
<pre class="r"><code>DM &lt;- data.frame(Feature1=runif(100),
                 Feature2=rnorm(100))

layout(matrix(c(2,1,0,3),nrow=2),widths=c(4,1),heights=c(1,4))
par(mar=c(3,3,0,0),mgp=2:0)
plot(DM,pch=20)
par(mar=c(0,3,1,1),bty=&quot;n&quot;)
boxplot(DM$Feature1,horizontal=T,xaxt=&quot;n&quot;,pch=20)
par(mar=c(3,0,1,1),bty=&quot;n&quot;)
boxplot(DM$Feature2,horizontal=F,yaxt=&quot;n&quot;,pch=20)</code></pre>
<p><img src="mod_me_files/figure-html/unnamed-chunk-1-1.png" width="480" /></p>
</div>
<div id="cluster-the-data" class="section level2">
<h2>Cluster the data</h2>
<pre class="r"><code>temp_CL &lt;- kmeans(DM,centers=2)
DM$Clusters &lt;- temp_CL$cluster

layout(matrix(c(2,1,4,3),nrow=2),widths=c(4,1),heights=c(1,4))
par(mar=c(3,3,0,0),mgp=2:0)
plot(Feature2~Feature1,data=DM,
     pch=20,col=c(&quot;red&quot;,&quot;dodgerblue&quot;)[DM$Clusters])
points(temp_CL$centers,pch=3,cex=2,col=c(&quot;red&quot;,&quot;dodgerblue&quot;))

par(mar=c(0,3,1,1),bty=&quot;n&quot;)
boxplot(Feature1~Clusters,data=DM,
        horizontal=T,xaxt=&quot;n&quot;,pch=20,
        col=c(&quot;red&quot;,&quot;dodgerblue&quot;))

par(mar=c(3,0,1,1),bty=&quot;n&quot;)
boxplot(Feature2~Clusters,data=DM,
        horizontal=F,yaxt=&quot;n&quot;,pch=20,
        col=c(&quot;red&quot;,&quot;dodgerblue&quot;))

par(mar=c(0,0,0,0),bty=&quot;n&quot;)
plot(NA,NA,xlim=0:1,ylim=0:1,xaxt=&quot;n&quot;,yaxt=&quot;n&quot;,xlab=NA,ylab=NA)
legend(&quot;center&quot;,pch=3,pt.cex=2,bty=&quot;n&quot;,
       legend=paste(&quot;K-means&quot;,&quot;center&quot;,sep=&quot;\n&quot;))</code></pre>
<p><img src="mod_me_files/figure-html/unnamed-chunk-2-1.png" width="480" /></p>
</div>
<div id="test-difference-in-clusters" class="section level2">
<h2>Test difference in clusters</h2>
<p>Test the null hypothesis that the two clusters have been sampled from the same distribution.</p>
<pre class="r"><code>t.test(Feature1~Clusters,data=DM)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  Feature1 by Clusters
## t = -0.78805, df = 76.199, p-value = 0.4331
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.15420890  0.06676971
## sample estimates:
## mean in group 1 mean in group 2 
##       0.4947226       0.5384422</code></pre>
<pre class="r"><code>wilcox.test(Feature1~Clusters,data=DM)</code></pre>
<pre><code>## 
##  Wilcoxon rank sum test with continuity correction
## 
## data:  Feature1 by Clusters
## W = 1050, p-value = 0.4116
## alternative hypothesis: true location shift is not equal to 0</code></pre>
<pre class="r"><code>t.test(DM$Feature2[DM$Clusters == 1],
       DM$Feature2[DM$Clusters == 2])</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  DM$Feature2[DM$Clusters == 1] and DM$Feature2[DM$Clusters == 2]
## t = -12.285, df = 74.797, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.884114 -1.358319
## sample estimates:
##  mean of x  mean of y 
## -0.4554402  1.1657760</code></pre>
<pre class="r"><code>wilcox.test(DM$Feature2[DM$Clusters == 1],
            DM$Feature2[DM$Clusters == 2])</code></pre>
<pre><code>## 
##  Wilcoxon rank sum test with continuity correction
## 
## data:  DM$Feature2[DM$Clusters == 1] and DM$Feature2[DM$Clusters == 2]
## W = 0, p-value &lt; 2.2e-16
## alternative hypothesis: true location shift is not equal to 0</code></pre>
<p>Wow, Feature2 is significantly different (p = 8.9955496^{-17} by Wilcoxon rank-sum test) between the two clusters. What does that actually mean?</p>
</div>
<div id="frequentist-hypothesis-testing-from-first-principles" class="section level2">
<h2>Frequentist hypothesis testing from first principles</h2>
<p>“Parametric” testing has assumptions because it uses mathematically-defined distributions to define “chance of finding as extreme a result by chance”. If in doubt, you can always make your own background distribution by permutation testing. Here we’re essentially replicating the Student’s T-test (how likely is it that these means are the same?) using permutation testing:</p>
<pre class="r"><code># Permute cluster labels 1000 times:
BKGD &lt;- replicate(n=1e3,{ sample(DM$Clusters) })

# Calculate differences in mean for 1000 randomly assigned clusters 
# to generate null distributions for each feature:
F1bkgd_diffMean &lt;- apply(BKGD,2,function(X)
  mean(DM$Feature1[X==1]) - mean(DM$Feature1[X==2]))
F2bkgd_diffMean &lt;- apply(BKGD,2,function(X)
  mean(DM$Feature2[X==1]) - mean(DM$Feature2[X==2]))

# Calculate actual differences in means between clusters for each feature:
F1_diffMean &lt;- mean(DM$Feature1[DM$Clusters == 1]) - mean(DM$Feature1[DM$Clusters==2])
F2_diffMean &lt;- mean(DM$Feature2[DM$Clusters == 1]) - mean(DM$Feature2[DM$Clusters==2])

# Calculate p-values - proportion of random data at least as extreme as empirical data:
F1_pval &lt;- mean(abs(F1bkgd_diffMean) &gt;= abs(F1_diffMean))
F2_pval &lt;- mean(abs(F2bkgd_diffMean) &gt;= abs(F2_diffMean))


par(mfrow=c(2,1),mar=c(3,3,2,1),mgp=2:0)
hist(F1bkgd_diffMean,main=NA,
     xlab=&quot;Null distribution of differences in means for Feature1&quot;,
     xlim=c(min(F1bkgd_diffMean,F2bkgd_diffMean,F1_diffMean,F2_diffMean),
            max(F1bkgd_diffMean,F2bkgd_diffMean,F1_diffMean,F2_diffMean)))
abline(v=F1_diffMean,lwd=2,col=&quot;Purple&quot;)
text(F1_diffMean,par(&quot;usr&quot;)[4],xpd=NA,pos=3,
     labels=switch(as.character(F1_pval &lt;= 0),
                   &quot;FALSE&quot;=paste(&quot;p =&quot;,signif(F1_pval,2)),
                   &quot;TRUE&quot;=paste(&quot;p &lt;&quot;,1 / ncol(BKGD))))

hist(F2bkgd_diffMean,main=NA,
     xlab=&quot;Null distribution of differences in means for Feature2&quot;,
     xlim=c(min(F1bkgd_diffMean,F2bkgd_diffMean,F1_diffMean,F2_diffMean),
            max(F1bkgd_diffMean,F2bkgd_diffMean,F1_diffMean,F2_diffMean)))
abline(v=F2_diffMean,lwd=2,col=&quot;Purple&quot;)
text(F2_diffMean,par(&quot;usr&quot;)[4],xpd=NA,pos=3,
     labels=switch(as.character(F2_pval &lt;= 0),
                   &quot;FALSE&quot;=paste(&quot;p =&quot;,signif(F2_pval,2)),
                   &quot;TRUE&quot;=paste(&quot;p &lt;&quot;,1 / ncol(BKGD))))</code></pre>
<p><img src="mod_me_files/figure-html/unnamed-chunk-4-1.png" width="480" /></p>
<p>Purple line is empirical difference in mean. Note that the calculated p-value for Feature 2 was zero, but technically that’s not correct - all we can say is that the probability of seeing a value that extreme by chance is less than the number of random permutations we tested (1000).</p>
</div>
</div>
<div id="reminder-office-hours-fri-330pm" class="section level1">
<h1>Reminder: Office hours Fri 3:30pm</h1>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
